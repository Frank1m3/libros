<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
     <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <title>Libros disponibles</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
      integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <img
        src="/static/fotos/logo.jpg"
        alt="Logo"
        width="30"
        height="24"
        class="d-inline-block align-text-top"
      />
      DIGI-LIBROS
    </a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('contactos.vista_contacto') }}">Contactos</a></li>

        <li class="nav-item"><a class="nav-link" href="{{ url_for('tienda') }}">Tienda</a></li>
       <li class="nav-item">
        
  <a class="nav-link" href="{{ url_for('registrar.registrar_index') }}">Registrar Libro</a>
</li>


        <li class="nav-item dropdown">
          <a
            class="nav-link dropdown-toggle"
            href="#"
            id="navbarDropdown"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            Categorías
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
            <li>
              <a class="dropdown-item" href="{{ url_for('infantil.infantilIndex') }}"
                >Infantiles</a>
            </li>
            <li>
              <a class="dropdown-item" href="{{ url_for('novedad.novedadIndex') }}"
                >Novedades</a
              >
            </li>
            <li>
              <a class="dropdown-item" href="{{ url_for('romance.romanceIndex') }}"
                >Romance</a
              >
            </li>
          </ul>
        </li>
        
        <li class="nav-item dropdown">
          <a
            class="nav-link dropdown-toggle"
            href="#"
            id="navbarDropdown"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            Referenciales
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
            <li>
              <a class="dropdown-item" href="{{ url_for('autor.autorIndex') }}"
                >Autor</a>
            </li>
            <li>
              <a class="dropdown-item" href="{{ url_for('editorial.editorialIndex') }}"
                >Editoriales</a
              >
            </li>
            <li>
              <a class="dropdown-item" href="{{ url_for('tomo.tomoIndex') }}"
                >Tomo</a
              >
            </li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="verCarrito"
            ><i class="fa-solid fa-cart-shopping"></i> Carrito (<span
              id="carritoCantidad"
              >0</span
            >)</a
          >
        </li>
      </ul>

      <!-- Formulario de búsqueda (ahora primero y alineado a la derecha) -->
      <form class="d-flex ms-auto" id="formBuscar" onsubmit="buscarLibros(event)">
  <input
    class="form-control me-2"
    type="search"
    placeholder="Buscar libros..."
    name="query"
    id="inputBuscar"
  />
  <button class="btn btn-outline-success" type="submit">Buscar</button>
</form>

<div id="resultadosBusqueda" class="mt-4"></div>

      <!-- Usuario y logout (con margen a la izquierda para separarlo del formulario) -->
      <ul class="navbar-nav ms-3">
        {% if session.usuario_nombre %}
          <li class="nav-item">
            <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">
              <i class="fa-solid fa-user"></i> {{ session.usuario_nombre }}
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('login.logout') }}">
              <i class="fa-solid fa-right-from-bracket"></i> Cerrar sesión
            </a>
          </li>
        {% else %}
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('login.login') }}">
              <i class="fa-solid fa-right-to-bracket"></i> Iniciar sesión
            </a>
          </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

<div class="container my-4">
  <h1 class="text-center">LIBROS DISPONIBLES.</h1>
  <div class="row justify-content-center">
    <!-- Tarjetas de libros -->
    <div class="col-md-3 mb-4">
      <div class="card h-100">
        <img
          src="/static/fotos/elinversor.jpg"
          class="card-img-top"
          alt="Antes de diciembre"
        />
        <div class="card-body">
          <h5 class="card-title">El Inversor Inteligente</h5>
          <p class="card-text">₲350.000</p>
          <button class="btn btn-primary" onclick="agregarAlCarrito(0)">
            Agregar al carrito
          </button>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-4">
      <div class="card h-100">
        <img src="/static/fotos/habitos.jpg" class="card-img-top" alt="La vida" />
        <div class="card-body">
          <h5 class="card-title">Hábitos Atómicos Chico</h5>
          <p class="card-text">₲140.000</p>
          <button class="btn btn-primary" onclick="agregarAlCarrito(1)">
            Agregar al carrito
          </button>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-4">
      <div class="card h-100">
        <img
          src="/static/fotos/Padre.jpg"
          class="card-img-top"
          alt="Padre Rico Padre Pobre "
        />
        <div class="card-body">
          <h5 class="card-title">Padre Rico Padre Pobre </h5>
          <p class="card-text">₲120.000</p>
          <button class="btn btn-primary" onclick="agregarAlCarrito(2)">
            Agregar al carrito
          </button>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-4">
      <div class="card h-100">
        <img
          src="/static/fotos/elprincipito.jpg"
          class="card-img-top"
          alt="El principito"
        />
        <div class="card-body">
          <h5 class="card-title">El principito</h5>
          <p class="card-text">₲100.000 GS</p>
          <button class="btn btn-primary" onclick="agregarAlCarrito(3)">
            Agregar al carrito
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<footer class="bg-light py-4 mt-4">
  <div class="container">
    <div class="row">
      <div class="col-xl-4">
        <h6>Redes sociales</h6>
        <p>
          <a href="#">Facebook</a> <i class="fa-brands fa-facebook"></i>
        </p>
        <p>
         <a href="https://www.instagram.com/frank1_m3" target="_blank" rel="noopener noreferrer">
  <i class="fa-brands fa-instagram"></i> Instagram
</a>

        
      </div>
      <div class="col-xl-4">
        <h6>Medios de contacto</h6>
        <p><a href="mailto:francomereles24@gmail.com">francomereles24@gmail.com</a></p>
        <p>
  <a href="https://wa.me/595992752919" target="_blank" rel="noopener noreferrer">
 <i class="fa-brands fa-whatsapp"></i> whatsapp
  </a>
</p>
        <p><a href="#">Sucursal: ÑEMBY</a></p>
      </div>
      <div class="col-12 text-center mt-3">
        <small>
          DIGI-LIBROS
        </small>
      </div>
    </div>
  </div>
</footer>

<!-- Modal del carrito -->
<div
  class="modal fade"
  id="carritoModal"
  tabindex="-1"
  aria-labelledby="carritoModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="carritoModalLabel">Tu carrito</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Cerrar"
        ></button>
      </div>
      <div class="modal-body">
        <ul id="carritoItems" class="list-group"></ul>
        <p id="carritoTotal" class="mt-3 fs-5 fw-bold"></p>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Cerrar
        </button>
        <button type="button" class="btn btn-primary" onclick="finalizarCompra()">
          Finalizar compra
        </button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/static/js/funciones.js"></script>
<script src="{{ url_for('static', filename='js/funciones.js') }}"></script>
</body>
</html>
<script>
  // Lista de productos (deben coincidir con los botones en orden)
  const productos = [
    { nombre: "El Inversor Inteligente", precio: 350000 },
    { nombre: "Hábitos Atómicos Chico", precio: 140000 },
    { nombre: "Padre Rico Padre Pobre", precio: 120000 },
    { nombre: "El principito", precio: 100000 }
  ];

  const carrito = [];

  function agregarAlCarrito(index) {
    const producto = productos[index];

    // Buscar si ya está en el carrito
    const existente = carrito.find(item => item.nombre === producto.nombre);
    if (existente) {
      existente.cantidad += 1;
    } else {
      carrito.push({ ...producto, cantidad: 1 });
    }

    actualizarCarrito();
  }

  function actualizarCarrito() {
    const lista = document.getElementById("carritoItems");
    const total = document.getElementById("carritoTotal");
    const cantidadSpan = document.getElementById("carritoCantidad");

    lista.innerHTML = "";

    let totalCarrito = 0;
    let totalItems = 0;

    carrito.forEach(item => {
      const li = document.createElement("li");
      li.classList.add("list-group-item", "d-flex", "justify-content-between", "align-items-center");
      li.innerHTML = `
        ${item.nombre} x${item.cantidad}
        <span>₲${(item.precio * item.cantidad).toLocaleString()}</span>
      `;
      lista.appendChild(li);

      totalCarrito += item.precio * item.cantidad;
      totalItems += item.cantidad;
    });

    total.textContent = `Total: ₲${totalCarrito.toLocaleString()}`;
    cantidadSpan.textContent = totalItems;
  }

  // Mostrar modal al hacer clic en el ícono del carrito
  document.getElementById("verCarrito").addEventListener("click", function (e) {
    e.preventDefault();
    const modal = new bootstrap.Modal(document.getElementById("carritoModal"));
    modal.show();
  });

  // Simulación de finalizar compra
  function finalizarCompra() {
    if (carrito.length === 0) {
      alert("Tu carrito está vacío.");
      return;
    }

    alert("¡Compra realizada con éxito!");
    carrito.length = 0;
    actualizarCarrito();

    // Cerrar modal
    const modal = bootstrap.Modal.getInstance(document.getElementById("carritoModal"));
    modal.hide();
  }
  function buscarLibros(event) {
  event.preventDefault(); // Evita que el formulario haga submit normal

  const query = document.getElementById("inputBuscar").value.trim();
  if (!query) {
    document.getElementById("resultadosBusqueda").innerHTML = "<p>Ingrese un término para buscar.</p>";
    return;
  }

  fetch(`/buscar_ajax?query=${encodeURIComponent(query)}`)
    .then(response => {
      if (!response.ok) throw new Error("Error en la búsqueda");
      return response.json();
    })
    .then(data => {
      mostrarResultados(data);
    })
    .catch(error => {
      document.getElementById("resultadosBusqueda").innerHTML = `<p>Error: ${error.message}</p>`;
    });
}

function mostrarResultados(libros) {
  const contenedor = document.getElementById("resultadosBusqueda");

  if (libros.length === 0) {
    contenedor.innerHTML = "<p>No se encontraron libros.</p>";
    return;
  }

  let html = '<div class="row">';
  libros.forEach(libro => {
    html += `
      <div class="col-md-3 mb-4">
        <div class="card h-100">
          <img src="${libro.imagen_url}" class="card-img-top" alt="${libro.titulo}" />
          <div class="card-body">
            <h5 class="card-title">${libro.titulo}</h5>
            <p class="card-text">₲${libro.precio.toLocaleString()}</p>
            <button class="btn btn-primary" onclick="agregarAlCarritoPorId(${libro.id})">Agregar al carrito</button>
          </div>
        </div>
      </div>
    `;
  });
  html += '</div>';

  contenedor.innerHTML = html;
}

// Opcional: función para agregar al carrito usando el id (necesitarías ajustar tu carrito)
function agregarAlCarritoPorId(id) {
  alert("Agregar al carrito libro con id: " + id);
  // Aquí va la lógica para agregar al carrito según tu estructura real
}

</script>
